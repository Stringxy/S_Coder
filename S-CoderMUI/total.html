<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<!--标准mui.css-->
		<link rel="stylesheet" href="css/mui.min.css">

		<!--App自定义的css-->
		<link rel="stylesheet" type="text/css" href="css/app.css" />
		<link rel="stylesheet" type="text/css" href="css/new_file.css" />
		<title>index</title>
		<style>
			.title {
				margin: 20px 15px 10px;
				color: #6d6d72;
				font-size: 15px;
			}
			
			.oa-contact-cell.mui-table .mui-table-cell {
				padding: 11px 0;
				vertical-align: middle;
			}
			
			.oa-contact-cell {
				position: relative;
				margin: -11px 0;
			}
			
			.oa-contact-avatar {
				width: 75px;
			}
			
			.oa-contact-avatar img {
				border-radius: 50%;
			}
			
			.oa-contact-content {
				width: 100%;
			}
			
			.oa-contact-name {
				margin-right: 20px;
			}
			
			.oa-contact-name,
			oa-contact-position {
				float: left;
			}
			
			.mui-scroll-wrapper {
				position: relative;
				overflow: inherit;
			}
			
			.mui-off-canvas-wrap {
				overflow: inherit;
			}
			
			.mui-scroll {
				position: relative;
			}
			
			.xoded {
				height: 360px;
			}
			
			.mui-icon-bars:before {
				content: close-quote;
			}
			
			.mui-pull-left {
				width: 10%;
			}
			
			.mui-bar-tab~.mui-content {
				height: 100%;
			}
			
			.mui-bar-tab .mui-tab-item.mui-active {
				color: #5272f9;
			}
			
			.menuicon {
				width: 14%;
				padding-right: 10px;
			}
			
			.mui-card-content {
				height: 70px;
				padding-left: 6%;
			}
			
			.question-card {
				background-color: rgb(219, 239, 222);
			}
			
			a {
				color: #757779;
			}
			
			.mui-card-header {
				font-size: 15px;
			}
			
			.mui-card {
				font-size: 12px;
			}
			
			.mui-card-footer {
				background-color: #eee;
			}
			
			#pullrefresh {
				height: 700px;
			}
		</style>
	</head>

	<body style="height: 100%;">
		<!--<nav class="mui-bar mui-bar-tab">
			<a class="mui-tab-item mui-active" href="#tabbar">
				<span class="mui-icon "><img src="img/index_nc.png"></span>
				<span class="mui-tab-label">首页</span>
			</a>
			<a class="mui-tab-item" href="#tabbar-with-chat">
				<span class="mui-icon mui-icon-email"></span>
				<span class="mui-tab-label">消息</span>
			</a>
			<a class="mui-tab-item" href="#tabbar-with-contact" name="c3">
				<span class="mui-icon mui-icon-contact"></span>
				<span class="mui-tab-label">通讯录</span>
			</a>

		</nav>-->
		<!--<div class="mui-content">-->
		<!--<div id="tabbar" class="mui-control-content mui-active">-->
		<div id="offCanvasWrapper" class="mui-off-canvas-wrap mui-draggable mui-scalable">
			<!--侧滑菜单部分-->
			<aside id="offCanvasSide" class="mui-off-canvas-left">
				<div id="offCanvasSideScroll" class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<div class="title">侧滑导航</div>
						<div class="content">

							<div class="touxiang" style="width: 30%;padding-left: 5%;position: relative;"><img src="img/avatar0.jpg">
								<span id="nickname" style="color: whitesmoke;position: absolute;right: -190%;z-index: 99;bottom: 5%;">Rhaast</span></div>
							<ul class="mui-table-view mui-table-view-chevron mui-table-view-inverted">
								<li class="mui-table-view-cell">
									<a class="mui-navigate-right" href="person.html">
										<img src="img/person.png" class="menuicon" />个人主页
									</a>
								</li>
								<li class="mui-table-view-cell">
									<a class="mui-navigate-right" href="addNote.html">
										<img src="img/message.png" class="menuicon" />发笔记
									</a>
								</li>
								<li class="mui-table-view-cell">
									<a class="mui-navigate-right">
										<img src="img/message.png" class="menuicon" />提问题
									</a>
								</li>
								<li class="mui-table-view-cell">
									<a class="mui-navigate-right">
										<img src="img/message.png" class="menuicon" />消息
									</a>
								</li>
								<li class="mui-table-view-cell">
									<a class="mui-navigate-right" href="login.html">
										<img src="img/person_back.png" class="menuicon" />切换账号
									</a>
								</li>
							</ul>
						</div>
						<!--<div class="title" style="margin-bottom: 25px;">侧滑列表示例</div>-->

					</div>
				</div>
			</aside>
			<!--主界面部分-->

			<div class="mui-inner-wrap">

				<header class="mui-bar mui-bar-nav">
					<a href="#offCanvasSide" class="mui-icon mui-action-menu mui-icon-bars mui-pull-left"><img src="img/index_aside.png"></a>
					<a class="mui-action-back mui-btn mui-btn-link mui-pull-right">关闭</a>
					<h1 class="mui-title">Home</h1>
				</header>
				<div id="offCanvasContentScroll" class="mui-content mui-scroll-wrapper">
					<div id="pullrefresh" class="mui-content">

						<div id="slider" class="mui-slider">
							<div class="mui-slider-group mui-slider-loop">
								<!-- 额外增加的一个节点(循环轮播：第一个节点是最后一张轮播) -->
								<div class="mui-slider-item mui-slider-item-duplicate">
									<a href="#">
										<img src="img/yuantiao.jpg">
									</a>
								</div>
								<!-- 第一张 -->
								<div class="mui-slider-item">
									<a href="#">
										<img src="img/shuijiao.jpg">
									</a>
								</div>
								<!-- 第二张 -->
								<div class="mui-slider-item">
									<a href="#">
										<img src="img/muwu.jpg">
									</a>
								</div>
								<!-- 第三张 -->
								<div class="mui-slider-item">
									<a href="#">
										<img src="img/cbd.jpg">
									</a>
								</div>
								<!-- 第四张 -->
								<div class="mui-slider-item">
									<a href="#">
										<img src="img/yuantiao.jpg">
									</a>
								</div>
								<!-- 额外增加的一个节点(循环轮播：最后一个节点是第一张轮播) -->
								<div class="mui-slider-item mui-slider-item-duplicate">
									<a href="#">
										<img src="img/shuijiao.jpg">
									</a>
								</div>
							</div>
							<div class="mui-slider-indicator">
								<div class="mui-indicator mui-active"></div>
								<div class="mui-indicator"></div>
								<div class="mui-indicator"></div>
								<div class="mui-indicator"></div>
							</div>

						</div>

						<!--数据列表-->
						<div id="indexContent">

						</div>

					</div>
					<div class="mui-off-canvas-backdrop"></div>
				</div>
			</div>
		</div>
		<!--		</div>-->

		<!--<div id="tabbar-with-chat" class="mui-control-content">
			<div class="title">这是div模式选项卡中的第2个子页面，该页面展示一个消息列表</div>

		</div>
		<div id="tabbar-with-contact" class="mui-control-content">

		</div>-->

	</body>

	<script type="text/javascript" src="js/mui.min.js"></script>
	<script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
	<script type="text/javascript" src="js/common.js"></script>
	<script>
		mui.plusReady(function() {
			ifLogin();
			getName();
		});
		$(function() {
			//getIndexContent();
		})

		function getName() {
			var nickname = localStorage.getItem("nickName");
			$("#nickname").html(nickname);
			var portrait = localStorage.getItem("portrait");
			$(".touxiang img").attr("src", portrait);
		}

		function getIndexContent() {
			var now = new Date();

			var mineUrl = "http://112.74.187.146:8080/studyapp/note/findAll";
			$.get(mineUrl, function(result) {
				var str = "";
				if (result.detail == null) {
					str = "<h3>当前没有发表笔记哦！</h3>";
				} else {
					for (var i = 0; i < result.detail.length; i++) {
						var title = result.detail[i].title;
						var content = result.detail[i].content;
						var commentNum = result.detail[i].commentNum;
						username = result.detail[i].userName;
						var createTime = new Date(result.detail[i].createTime);
						var diffTime = (now - createTime) / (1000 * 60);
						var type = result.detail[i].type;
						if (diffTime <= 3) {
							createTime = "刚刚";
						} else if (diffTime > 3 && diffTime < 10) {
							createTime = "三分钟前";
						} else {
							createTime = createTime.getFullYear() + "年" + (createTime.getMonth() + 1) + "月" + createTime.getDate() + "日";
						}
						if (type == 0) {
							str += '<div class="mui-card">';
						} else {
							str += '<div class="mui-card question-card">';
						}
						str += '<div class="mui-card-header"><a href="noteDetail.html?id=' + result.detail[i].id + '">' + title + '</a><div class="mui-media-body"><a href="other.html?id=' + result.detail[i].userId + '">' + username + '</a></div></div>';
						str += '<div class="mui-card-content">' + content + '</div>';
						str += '	<div class="mui-card-footer">发布时间：' + createTime + '<span>评论：' + commentNum + '条</span></div></div>';
					}
				}

				$("#indexContent").append(str);
			})
		}

		mui.init({
			pullRefresh: {
				container: '#pullrefresh',
				up: {
					contentrefresh: '正在加载...',
					callback: pullupRefresh
				}
			}
		});
		/**
		 * 下拉刷新具体业务实现
		 */
		function pulldownRefresh() {
			setTimeout(function() {
				//					var table = document.body.querySelector('.mui-table-view');
				//					var cells = document.body.querySelectorAll('.mui-table-view-cell');
				//					for (var i = cells.length, len = i + 3; i < len; i++) {
				//						var li = document.createElement('li');
				//						li.className = 'mui-table-view-cell';
				//						li.innerHTML = '<a class="mui-navigate-right">Item ' + (i + 1) + '</a>';
				//						//下拉刷新，新纪录插到最前面；
				//						table.insertBefore(li, table.firstChild);
				//					}

				mui('#pullrefresh').pullRefresh().endPulldownToRefresh(); //refresh completed
			}, 1500);
		}
		var count = 0;
		/**
		 * 上拉加载具体业务实现
		 */
		function pullupRefresh() {
			setTimeout(function() {
				mui('#pullrefresh').pullRefresh().endPullupToRefresh((++count > 2)); //参数为true代表没有更多数据了。
				getIndexContent();
				//					var table = document.body.querySelector('.mui-table-view');
				//					var cells = document.body.querySelectorAll('.mui-table-view-cell');
				//					for (var i = cells.length, len = i + 20; i < len; i++) {
				//						var li = document.createElement('li');
				//						li.className = 'mui-table-view-cell';
				//						li.innerHTML = '<a class="mui-navigate-right">Item ' + (i + 1) + '</a>';
				//						table.appendChild(li);
				//					}
			}, 1500);
		}
		if (mui.os.plus) {
			mui.plusReady(function() {
				setTimeout(function() {
					mui('#pullrefresh').pullRefresh().pullupLoading();
				}, 1000);

			});
		} else {
			mui.ready(function() {
				mui('#pullrefresh').pullRefresh().pullupLoading();
			});
		}

		(function($) {
			$(".mui-scroll-wrapper").scroll({
				//bounce: false,//滚动条是否有弹力默认是true
				//indicators: false, //是否显示滚动条,默认是true
			});
		})(mui);
	</script>

</html>