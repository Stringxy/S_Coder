<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<title></title>
	</head>

	<script type="text/javascript" src="js/mui.min.js"></script>
	<script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
	<script type="text/javascript" src="js/common.js"></script>
	<!--标准mui.css-->
	<link rel="stylesheet" href="css/mui.min.css">
	<!--App自定义的css-->
<!--	<link rel="stylesheet" type="text/css" href="css/app.css" />-->
	<link rel="stylesheet" href="css/total.css" />

	<body>
		<!-- 主界面不动、菜单移动 -->
		<!-- 侧滑导航根容器 -->
		<div class="mui-off-canvas-wrap mui-slide-in">
			<!-- 菜单容器 -->
			<aside class="mui-off-canvas-left" id="offCanvasSide">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<!-- 菜单具体展示内容 -->
						<div class="touxiang" style="width: 30%;padding-left: 5%;position: relative;"><img style="width: 130%;margin-top: 15%;" src="img/avatar0.jpg">
							<span id="nickname" style="color: whitesmoke;position: absolute;right: -190%;z-index: 99;bottom: 5%;">Rhaast</span></div>
						<ul class="mui-table-view mui-table-view-chevron mui-table-view-inverted">
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right" href="person.html">
									<img src="img/person.png" class="menuicon" />个人主页
								</a>
							</li>
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right" href="addNote.html">
									<img src="img/message.png" class="menuicon" />发笔记
								</a>
							</li>
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right" href="addQues.html">
									<img src="img/message.png" class="menuicon" />提问题
								</a>
							</li>
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right">
									<img src="img/message.png" class="menuicon" />消息
								</a>
							</li>
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right" href="login.html">
									<img src="img/person_back.png" class="menuicon" />切换账号
								</a>
							</li>
						</ul>
					</div>
				</div>
			</aside>
			<!-- 主页面容器 -->
			<div class="mui-inner-wrap">
				<!-- 主页面标题 -->
				<header class="mui-bar mui-bar-nav">
					<a class="mui-icon mui-action-menu mui-icon-bars mui-pull-left" href="#offCanvasSide"></a>
					<h1 class="mui-title">S_coder</h1>
				</header>

				<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
					<div class="mui-scroll">
						<!-- 主界面具体展示内容 -->
						<!--banner-->
						<div id="slider" class="mui-slider">
							<div class="mui-slider-group mui-slider-loop">
								<!-- 额外增加的一个节点(循环轮播：第一个节点是最后一张轮播) -->
								<div class="mui-slider-item mui-slider-item-duplicate">
									<a href="#">
										<img src="img/banner1.jpg">
									</a>
								</div>
								<!-- 第一张 -->
								<div class="mui-slider-item">
									<a href="#">
										<img src="img/banner2.jpg">
									</a>
								</div>
								<!-- 第二张 -->
								<div class="mui-slider-item">
									<a href="#">
										<img src="img/banner3.jpg">
									</a>
								</div>
								<!-- 第三张 -->
								<div class="mui-slider-item">
									<a href="#">
										<img src="img/cbd.jpg">
									</a>
								</div>
								<!-- 第四张 -->
								<div class="mui-slider-item">
									<a href="#">
										<img src="img/yuantiao.jpg">
									</a>
								</div>
								<!-- 额外增加的一个节点(循环轮播：最后一个节点是第一张轮播) -->
								<div class="mui-slider-item mui-slider-item-duplicate">
									<a href="#">
										<img src="img/shuijiao.jpg">
									</a>
								</div>
							</div>
							<div class="mui-slider-indicator">
								<div class="mui-indicator mui-active"></div>
								<div class="mui-indicator"></div>
								<div class="mui-indicator"></div>
								<div class="mui-indicator"></div>
							</div>

						</div>
						<!--banner-->

						<!--数据列表-->
						<div id="indexContent">

						</div>
					</div>
				</div>
				<div class="mui-off-canvas-backdrop"></div>
			</div>
		</div>
	</body>
	<script>
		mui.plusReady(function() {
			ifLogin();
			getName();
			getIndexContent();
		});

		function getName() {
			var nickname = localStorage.getItem("nickName");
			$("#nickname").html(nickname);
			var portrait = localStorage.getItem("portrait");
			$(".touxiang img").attr("src", portrait);
		}

		function getIndexContent() {
			var now = new Date();
			$("#indexContent").html("");
			var mineUrl = "http://112.74.187.146:8080/studyapp/note/findAll";
			$.get(mineUrl, function(result) {
				var str = "";
				if (result.detail == null) {
					str = "<h3>当前没有发表笔记哦！</h3>";
				} else {
					for (var i = 0; i < result.detail.length; i++) {
						var title = result.detail[i].title;
						var content = result.detail[i].content;
						var commentNum = result.detail[i].commentNum;
						username = result.detail[i].userName;
						var createTime = new Date(result.detail[i].createTime);
						var diffTime = (now - createTime) / (1000 * 60);
						var type = result.detail[i].type;
						if (diffTime <= 3) {
							createTime = "刚刚";
						} else if (diffTime > 3 && diffTime < 10) {
							createTime = "三分钟前";
						} else {
							createTime = createTime.getFullYear() + "年" + (createTime.getMonth() + 1) + "月" + createTime.getDate() + "日";
						}
						if (type == 0) {
							str += '<div class="mui-card">';
						} else {
							str += '<div class="mui-card question-card">';
						}
						str += '<div class="mui-card-header"><a href="noteDetail.html?id=' + result.detail[i].id + '">' + title + '</a><div class="mui-media-body"><a href="other.html?id=' + result.detail[i].userId + '">' + username + '</a></div></div>';
						str += '<div class="mui-card-content">' + content + '</div>';
						str += '	<div class="mui-card-footer">发布时间：' + createTime + '<span>评论：' + commentNum + '条</span></div></div>';
					}
				}

				$("#indexContent").append(str);
			})
		}

		mui.init({
			pullRefresh: {
				container: '#pullrefresh',
				down: {
					style: 'circle', //必选，下拉刷新样式，目前支持原生5+ ‘circle’ 样式
					color: '#2BD009', //可选，默认“#2BD009” 下拉刷新控件颜色
					height: '50px', //可选,默认50px.下拉刷新控件的高度,
					range: '100px', //可选 默认100px,控件可下拉拖拽的范围
					offset: '0px', //可选 默认0px,下拉刷新控件的起始位置
					auto: true, //可选,默认false.首次加载自动上拉刷新一次
					callback: getIndexContent //必选，刷新函数，根据具体业务来编写，比如通过ajax从服务器获取新数据；
				}
			}
		});

		if (mui.os.plus) {
			mui.plusReady(function() {
				setTimeout(function() {
					mui('#pullrefresh').pullRefresh().pullupLoading();
				}, 1000);

			});
		} else {
			mui.ready(function() {
				mui('#pullrefresh').pullRefresh().pullupLoading();
			});
		}

		//		(function($) {
		//			$(".mui-scroll-wrapper").scroll({
		//				//bounce: false,//滚动条是否有弹力默认是true
		//				//indicators: false, //是否显示滚动条,默认是true
		//			});
		//		})(mui);

		mui('body').on('tap', 'a', function() {
			var id = this.getAttribute('href');
			var webview_style = {
				popGesture: "close"
			};

			mui.openWindow({
				id: id,
				url: this.href,
				styles: webview_style,
				show: {
					aniShow: true,
					aniShow:"slide-in-right",//页面显示动画，默认为”slide-in-right“；
      				duration:200
				},
				waiting: {
					autoShow: true,   
        			title: '正在加载...'
				}
			});
		})
		
		mui("#pullrefresh").scroll();
	</script>

</html>